<!DOCTYPE HTML>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <script>

    var dice1;
    var dice2;
    var doremiArray = [
      [0, 2, 4, 5, 7, 9, 11, 12, 12, 11, 9, 7, 5, 4, 2, 0],
      [0, 2, 3, 5, 7, 8, 10, 12, 12, 10, 8, 7, 5, 3, 2, 0],
      [0, 2, 3, 5, 7, 8, 11, 12, 12, 11, 8, 7, 5, 3, 2, 0],
      [0, 2, 3, 5, 7, 9, 11, 12, 12, 10, 8, 7, 5, 3, 2, 0]
    ];

    var audioContext;
    var oscillator;
    const doremi = () => {

      audioContext = new AudioContext();
      const t0 = audioContext.currentTime;
      let t = 0;

      var oscillator = audioContext.createOscillator();
      var gain = audioContext.createGain();

      oscillator.type = "square";//sine, square, sawtooth, triangle, custom
      doremiArray[dice2].forEach((s) => {
        const hz = 442 * Math.pow(2, (1 / 12 * (s + ((dice1 * 5) % 12) - 9)));
        oscillator.frequency.setValueAtTime(hz, t0 + t);
        gain.gain.setValueAtTime(0.01, t0 + t);
        t += 1;
      });
      oscillator.start(t0);
      oscillator.stop(t0 + t);
      oscillator.connect(gain);
      gain.connect(audioContext.destination);
    };

    function hint() {
      if (document.getElementById("hint").style["display"] == "flex") {
        document.getElementById("hint").style["display"] = "none";
        doremi();
      } else {
        document.getElementById("hint").style["display"] = "flex";
        doremi();
      }
    }

    function scale() {
      if (document.getElementById("saisyo").style["display"] == "none") {
        document.getElementById("saisyo").style["display"] = "block";
        document.getElementById("kekka").style["display"] = "none";
        document.getElementById("button").innerHTML = "今日のスケールは？";
        return;
      }

      document.getElementById("saisyo").style["display"] = "none";
      //document.getElementById("kekka").src = "images/" + image_name;
      document.getElementById("kekka").style["display"] = "flex";
      document.getElementById("hint").style["display"] = "none";
      var imgArray = [
        ["C_dur.png", "F_dur.png", "B_dur.png", "Es_dur.png", "As_dur.png", "Des_dur.png", "Fis_dur.png", "H_dur.png", "E_dur.png", "A_dur.png", "D_dur.png", "G_dur.png"],
        ["C_moll1.png", "F_moll1.png", "B_moll1.png", "Es_moll1.png", "As_moll1.png", "Des_moll1.png", "Fis_moll1.png", "H_moll1.png", "E_moll1.png", "A_moll1.png", "D_moll1.png", "G_moll1.png"],
        ["C_moll2.png", "F_moll2.png", "B_moll2.png", "Es_moll2.png", "As_moll2.png", "Des_moll2.png", "Fis_moll2.png", "H_moll2.png", "E_moll2.png", "A_moll2.png", "D_moll2.png", "G_moll2.png"],
        ["C_moll3.png", "F_moll3.png", "B_moll3.png", "Es_moll3.png", "As_moll3.png", "Des_moll3.png", "Fis_moll3.png", "H_moll3.png", "E_moll3.png", "A_moll3.png", "D_moll3.png", "G_moll3.png"]
      ];


      dice1 = Math.floor(Math.random() * 12);
      dice2 = Math.floor(Math.random() * 4);

      var key = "C";
      switch (dice1) {
        case 0:
          key = "C";
          break;
        case 1:
          key = "F";
          break;
        case 2:
          key = "B";
          break;
        case 3:
          key = "Es";
          break;
        case 4:
          key = "As";
          break;
        case 5:
          key = "Des";
          break;
        case 6:
          key = "Fis";
          break;
        case 7:
          key = "H";
          break;
        case 8:
          key = "E";
          break;
        case 9:
          key = "A";
          break;
        case 10:
          key = "D";
          break;
        default:
          key = "G";
          break;
      }

      var scale = "Major";
      switch (dice2) {
        case 0:
          scale = "Major";
          break;
        case 1:
          scale = "Natural Minor";
          break;
        case 2:
          scale = "Harmonic Minor";
          break;
        default:
          scale = "Melodic Minor";
          break;
      }
      document.getElementById("key").innerHTML = key;
      document.getElementById("scale").innerHTML = scale;
      document.getElementById("button").innerHTML = "もう一回練習するぞ！";
      document.getElementById("inC").src = "images/" + imgArray[dice2][dice1];
      var inB = dice1 - 2;
      if (inB < 0) {
        inB = 12 + inB;
      }
      var inEs = dice1 - 3;
      if (inEs < 0) {
        inEs = 12 + inEs;
      }
      var inF = dice1 - 1;
      if (inF < 0) {
        inF = 12 + inF;
      }
      var inAs = dice1 + 1;
      if (inAs > 11) {
        inAs = 12 - inAs;
      }

      document.getElementById("inB").src = "images/" + imgArray[dice2][inB];
      document.getElementById("inEs").src = "images/" + imgArray[dice2][inEs];
      document.getElementById("inF").src = "images/" + imgArray[dice2][inF];
      // document.getElementById("inAs").src = "images/" + imgArray[dice2][inAs];

      //読み上げ
      if ('speechSynthesis' in window) {
        // 発言を設定 (必須)
        const uttr = new SpeechSynthesisUtterance()

        // テキストを設定 (必須)
        uttr.text = key;
        // 言語を設定
        uttr.lang = "de-DE"
        // 速度を設定
        uttr.rate = 1
        // 高さを設定
        uttr.pitch = 1
        // 音量を設定
        uttr.volume = 1

        // 発言を再生 (必須)
        window.speechSynthesis.speak(uttr)

        // テキストを設定 (必須)
        uttr.text = scale;
        // 言語を設定
        uttr.lang = "en-US"
        window.speechSynthesis.speak(uttr)
      }


    }
  </script>

  <style>
    html,
    body {
      margin: 0;
      padding: 0;
    }

    body {
      font-family: YuGothic, "游ゴシック体", "Yu Gothic", "ヒラギノ角ゴ Pro", "Hiragino Kaku Gothic Pro", "メイリオ", Meiryo, "ＭＳ Ｐゴシック", "MS PGothic", sans-serif;
      letter-spacing: .025em;
      line-height: 1.8;
      text-align: center;
    }

    .bg_pattern {
      display: flex;
      flex-direction: column;
      width: 100vw;
      height: 100vh;
      background-color: #ffffff;
    }

    .Polka {
      background-image: radial-gradient(#ffcccc 2px, #ffffff 2px);
      background-size: 20px 20px;
    }

    main {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 80%;
      width: 100%;
    }

    footer {
      height: 20%;
    }

    #saisyo {
      max-width: 90%;
      max-height: 90%;
      display: block;
      margin: 0 auto;
    }

    #kekka {
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 90%;
      height: 90%;
    }

    .section {
      color: #FFF;
      text-shadow:
        0 0 0.05em #F06292,
        0 0 0.10em #F06292,
        0 0 0.15em #F06292,
        0 0 0.30em #F06292;
      filter: saturate(80%);
      background: #fcfcfc;
      width: 80%;
      padding: 10px;
      justify-content: center;
      align-items: center;
      border: 10px double #222222;
      font-size: 36px;
      font-weight: bold;
      text-decoration: none;
      text-align: center;
    }

    #hintbutton {
      margin: 0;
      font-size: 18px;
      display: inline-block;
      padding: 0.4em 1em 0.2em;
      color: #ffffff;
      border: #222222 1px;
      border-radius: 0px 0px 10px 10px;
      background-color: #222222;
      cursor: pointer;
    }

    #hint {
      border: 2px #222222 solid;
      flex-grow: 1;
      padding: 10px;
      display: flex;
      flex-direction: column;
      height: auto;
      overflow: auto;
      width: 80%;
      background-color: #ffffff;
      text-align: right;
      border-radius: 0px 0px 10px 10px;
    }

    #hint img {
      width: 80%;
      display: inline;
      vertical-align: middle;
    }

    #button {
      font-size: 18px;
      display: inline-block;
      text-align: right;
      padding: 0.4em 1em 0.2em;
      color: #ffffff;
      border: #ffffff dashed 1px;
      box-shadow: 0 0 0 0.2em #ff99cc;
      border-radius: 2.5px;
      background-color: #ff99cc;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <div class="bg_pattern Polka">
    <main>
      <img id="saisyo" src="images/conductor.png" />
      <div id="kekka" style="display:none;">

        <div class="section">
          <div id="key">C</div>
          <div id="scale">Major</div>
        </div>
        <div id="hint" display="none">
          <div><span>in C:</span><img id="inC" src="images/c_dur.png" /></div>
          <div><span>in B:</span><img id="inB" src="images/d_dur.png" /></div>
          <div><span>in Es:</span><img id="inEs" src="images/a_dur.png" /></div>
          <div><span>in F:</span><img id="inF" src="images/g_dur.png" /></div>
          <!--<div><span>in As:</span><img id="inAs" src="images/e_dur.png" /></div>-->
        </div>
        <button id="hintbutton" onclick="hint()">ヒント！</button>
      </div>
    </main>
    <footer>
      <button id="button" onclick="scale()">今日のスケールは？</button>
    </footer>
  </div>
</body>

</html>
